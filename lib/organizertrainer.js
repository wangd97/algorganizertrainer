"use strict";var algset=$_GET("algset");function $_GET(t){if(-1!==document.location.toString().indexOf("?"))for(var e=document.location.toString().replace(/^.*?\?/,"").replace(/#.*$/,"").split("&"),r=0,a=e.length;r<a;r++){var i=decodeURIComponent(e[r]).split("=");if(i[0]===t)return i[1]}return null}$(document).prop("title","Algorithms: "+pageDetails[algset].title);var cases=algsetData[algset].map(function(t,e){return{id:e,name:t.name,img:t.name,alg:t.alg,group:t.group}}),chosenAlgs=localStorageSupported()&&null!=localStorage.getItem("chosenAlgs"+algset)?JSON.parse(localStorage.getItem("chosenAlgs"+algset)):defaultChosenAlgs(),statuses=localStorageSupported()&&null!=localStorage.getItem("statuses"+algset)?JSON.parse(localStorage.getItem("statuses"+algset)):defaultStatuses(),settings=localStorageSupported()&&null!=localStorage.getItem("settings"+algset)?JSON.parse(localStorage.getItem("settings"+algset)):defaultSettings(),times=localStorageSupported()&&null!=localStorage.getItem("times"+algset)?JSON.parse(localStorage.getItem("times"+algset)):defaultTimes(),trainingCases=getTrainingCases();function rotateScramble(t){for(var e=["R","B","L","F"],r=Math.floor(4*Math.random()),a=0;a<t.length;a++)for(var i=t.charAt(a),n=0;n<e.length;n++){i===e[n]&&(t=t.substring(0,a)+e[(n+r)%4]+t.substring(a+1,t.length))}return t.replace(/^U./g,"").replace(/U.?$/g,"").trim()}function checkLegalMoves(t){return/^(\(? *(([BRULFD]w)|[BRULFDMESxyz])[2']? *\)? *)+$/.test(t.trim())}function getPosition(t,e,r){return t.split(e,r).join(e).length}function getMoves(t,e){return t.substring(0,getPosition(t," ",e))}$(document).keydown(function(t){var e=t.keyCode||t.which;if("none"!==$("#trainer").css("display"))if(32===e&&0===timer.state)$("#timertd").css("color","rgb(0, 240, 0"),timer.state=1;else if(39===e)for(timer.hint++,console.log(timer.state),showHint();timer.thisAlg===getMoves(timer.thisAlg,timer.hint-1);)timer.hint--;else 37===e?(0<timer.hint&&timer.hint--,showHint()):2===timer.state&&timer.stop()&&(timer.state=3);timer.ready=!1}),$(document).keyup(function(t){var e=t.keyCode||t.which;"none"!==$("#trainer").css("display")&&(32===e&&1===timer.state?($("#timertd").css("color","rgb(0, 0, 0)"),timer.start()?timer.state=2:timer.state=0):3===timer.state&&(timer.state=0)),timer.ready=!0});var timer={hint:0,timeId:0,updateInterval:3,numDecimals:2,timerStartBuffer:20,timerStopBuffer:130,lastTimerStart:0,lastTimerStop:0,state:0,updater:null,hit:function(){1===timer.state?this.stop():2===timer.state&&this.start()},start:function(){var t=this;return!(Date.now()-this.lastTimerStop<this.timerStopBuffer)&&(this.lastTimerStart=Date.now(),this.updater=setInterval(function(){$("#timertd").html(numToTime((Date.now()-t.lastTimerStart)/1e3))},this.updateInterval),!0)},stop:function(){var t=Date.now(),e=t-this.lastTimerStart;return!(e<this.timerStartBuffer)&&(this.lastTimerStop=t,clearInterval(this.updater),$("#timertd").html((e/1e3).toFixed(this.numDecimals)),this.addTimeToList(e),this.getNewScramble(),$("#prevScramble").html(""),timer.hint=0,showHint(),!0)},addTimeToList:function(t){storeTime(this.timeId,t/1e3,this.thisCase),this.timeId++,this.displayTimes()},displayTimes:function(){var a=this,i=$("#timerlist");$(i).html("");for(var t=function(t){var e=document.createElement("span"),r=times[t];$(e).attr("timeId",r.timeId).html(times[t].time.toFixed(a.numDecimals)).click(function(){showCase(r.timeId)}).attr("class","link"),t===times.length-1?$(i).append(e):$(i).append(e).append(", ")},e=0;e<times.length;e++)t(e);$(i).scrollTop($(i)[0].scrollHeight)},getNewScramble:function(){var t,e,r=trainingCases[Math.floor(Math.random()*trainingCases.length)];t=formatAlgNoRotation(chosenAlgs[r]),e=rotateScramble(scrambles[algset][r][Math.floor(Math.random()*scrambles[algset][r].length)]),""===this.lastAlg?(this.lastAlg=t,this.lastScramble=e,this.lastCase=r):(this.lastAlg=this.thisAlg,this.lastScramble=this.thisScramble,this.lastCase=this.thisCase),this.thisAlg=t,this.thisScramble=e,this.thisCase=r,$("#scramble").text(this.thisScramble)},lastAlg:"",lastScramble:"",lastCase:"",thisAlg:"",thisScramble:"",thisCase:""};function numToTime(t){var e=Math.floor(t/3600),r=Math.floor((t-3600*e)/60),a=t-3600*e-60*r;e<10&&(e="0"+e),r<10&&(r="0"+r),(a=a.toFixed(timer.numDecimals))<10&&(a="0"+a);for(var i=e+":"+r+":"+a;i.startsWith("0")||i.startsWith(":");)i=i.substring(1,i.length);return i.startsWith(".")&&(i="0"+i),i}timer.timeId=0===times.length?0:times[times.length-1].timeId+1,showHint();var algTable=void 0;function resetAlgs(){confirm("Reset ALL algorithms to default?")&&(chosenAlgs=defaultChosenAlgs(),algTable=createTable())}function resetSettings(){settings=defaultSettings(),localStorageSupported()&&localStorage.setItem("settings"+algset,JSON.stringify(settings)),algTable=createTable()}function allowOptions(){$("#options li").click(function(){var t=$(this).find("input")[0];t.checked=!t.checked,storeSetting(t.name,t.checked),createTable()}).addClass("link").find("input").each(function(){this.checked=settings[this.name]})}function showAlgEditbox(r){$("#editbox").children().html(""),$("#editbox-image").html(convertContent(r,"img",getCaseById(r).img)),$("#editbox-text").html("Choose an algorithm:");var e=chosenAlgs[r],a=getCaseById(r).alg,i=Array.from({length:getCaseById(r).alg.length}).fill(null);$(i).each(function(t){i[t]=addElement(document.getElementById("editbox-list"),"li"),$(i[t]).attr("algindex",t).attr("chosen",0).html(formatAlg(a[t])),formatAlgHideTriggers(a[t])===formatAlgHideTriggers(chosenAlgs[r])&&(e="",$(i[t]).css("background-color","rgb(0, 255, 0)").attr("chosen",1))});var t=addElement(document.getElementById("editbox-list"),"li");$(t).attr("algindex",-1).attr("id","custom").html("<input type='text' value=\""+e+"\" maxlength='100' />"),e&&$(t).css("background-color","rgb(0, 255, 0)").attr("chosen",1),i.push(t),$(i).each(function(t,e){$(e).click(function(){$(this).parent().find("li").css("background-color","rgb(255, 255, 255)").attr("chosen",0),$(this).css("background-color","rgb(0, 255, 0)").attr("chosen",1)})});var n=addElement(document.getElementById("editbox-submit"),"button");$(n).html("Update").click(function(){var t=$("li[chosen=1]:first").attr("algindex");if(-1!=t)storeChosenAlg(r,getCaseById(r).alg[t]),createTable(),$(".overlay").hide();else{var e=formatAlgPretty($(i[i.length-1]).find("input")[0].value);checkLegalMoves(e)?(storeChosenAlg(r,e),createTable(),$(".overlay").hide()):alert("Incorrectly formatted algorithm:\n- For cube rotations, use lower case (x instead of X)\n- Don't use numbers larger than 2 (R' instead of R3)\n- Brackets cannot have modifiers afterwards")}});var s=addElement(document.getElementById("editbox-submit"),"button");$(s).html("Cancel").click(function(){$(".overlay").hide()}),$(".overlay").show()}function showCase(t){$("#hint").hide(),$("#showCase").show().children().html(""),$("#deleteButtonTrainer").show().off().click(function(){deleteTime(t),timer.displayTimes(),showHint()}),timer.hint=0;var e=getTimeById(t);$("#showCase .misc-header").html((pageDetails[algset].name+"-"+getCaseById(e.caseId).name).trim()+" ("+e.time.toFixed(timer.numDecimals)+")"),$("#showCase .misc-image").html(convertContent(e.caseId,"img","")),$("#showCase .misc-text").html(convertContent(e.caseId,"alg",""))}function showHint(){var t=timer.thisCase;$("#hint").show().children().html(""),$("#showCase").hide(),$("#deleteButtonTrainer").hide(),$("#hint .misc-header").html("Hint"),0===timer.hint?($("#hint .misc-image").html(convertContent(t,"img","solved")),$("#hint .misc-text").html("Use Left/Right arrow keys")):($("#hint .misc-image").html(convertContent(t,"img","")),$("#hint .misc-text").html(getMoves(timer.thisAlg,timer.hint)))}function getTimeById(t){for(var e=0;e<times.length;e++)if(Number(times[e].timeId)===Number(t))return times[e];return console.log("getTimeById didn't work"),!1}function getCaseById(t){var e=!0,r=!1,a=void 0;try{for(var i,n=cases[Symbol.iterator]();!(e=(i=n.next()).done);e=!0){var s=i.value;if(s.id===t)return s}}catch(t){r=!0,a=t}finally{try{!e&&n.return&&n.return()}finally{if(r)throw a}}}function getColorByStatus(t){switch(t){case 0:return"rgb(255, 255, 255)";case 1:return"rgb(255, 255, 0)";case 2:return"rgb(0, 255, 0)";default:return"rgb(255, 255, 255)"}}function allowStatus(){var t=algTable.getElementsByClassName("img"),e=!0,r=!1,a=void 0;try{for(var i,n=function(){var t=i.value,e=t.parentNode.className;"img"===t.className&&$(t).click(function(){toggleStatus(e)}).addClass("link")},s=Array.from(t)[Symbol.iterator]();!(e=(i=s.next()).done);e=!0)n()}catch(t){r=!0,a=t}finally{try{!e&&s.return&&s.return()}finally{if(r)throw a}}}function allowSorting(){var a=["img"],t=algTable.getElementsByClassName("heading"),e=!0,r=!1,i=void 0;try{for(var n,s=function(){var t=n.value,e=t.className.substring(t.className.indexOf(" ")+1,t.className.length);if(a.includes(e))return"continue";var r=addElement(t,"button");settings.sort.attribute===e?1===settings.sort.order?r.innerHTML="^":r.innerHTML="v":r.innerHTML="^v",$(r).click(function(){sortTableBy(e)})},o=Array.from(t)[Symbol.iterator]();!(e=(n=o.next()).done);e=!0)s()}catch(t){r=!0,i=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw i}}}function allowEdits(){var a=["alg"],t=algTable.getElementsByClassName("alg"),e=!0,r=!1,i=void 0;try{for(var n,s=function(){var t=n.value;if(!a.includes(t.className))return"continue";var e=Number(t.parentNode.className),r=addElement(t,"div");$(r).addClass("edit-button").addClass("link").html("<img src='../images/edit.png' class='editButton' alt='Edit'/>").click(function(){showAlgEditbox(e)}),$(t).mouseover(function(){$(r).show()}).mouseout(function(){$(r).hide()})},o=Array.from(t)[Symbol.iterator]();!(e=(n=o.next()).done);e=!0)s()}catch(t){r=!0,i=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw i}}}function createTable(){var t=["id"];sortCases(settings.sort.attribute,settings.sort.order);var e=$("#table_container");$(e).html(""),algTable=document.createElement("TABLE"),$(algTable).attr("id","table").attr("border","1");var r=addElement(algTable,"tr");for(var a in cases[0])t.includes(a)||$(addElement(r,"td")).addClass("heading "+a).html(convertHeading(a));var i=!0,n=!1,s=void 0;try{for(var o,l=cases[Symbol.iterator]();!(i=(o=l.next()).done);i=!0){var c=o.value,g=addElement(algTable,"tr");for(var u in $(g).addClass(c.id.toString()).css("background-color",getColorByStatus(statuses[c.id])),c)if(!t.includes(u)){var m=c[u];$(addElement(g,"td")).addClass(u).html(convertContent(c.id,u,m))}}}catch(t){n=!0,s=t}finally{try{!i&&l.return&&l.return()}finally{if(n)throw s}}$(e).append(algTable),allowEdits(),allowSorting(),allowStatus()}function sortTableBy(t){storeSetting("sort",{attribute:t,order:settings.sort.attribute===t&&1===settings.sort.order?-1:1}),createTable()}function sortCases(r,a){if(cases.sort(function(t,e){return"alg"===r?(algA=chosenAlgs[t.id],algB=chosenAlgs[e.id],countMoves(algA)>countMoves(algB)?a:countMoves(algA)<countMoves(algB)?-a:t.name>e.name?1:-1):t[r]>e[r]?a:t[r]<e[r]?-a:t.name>e.name?1:-1}),settings.finishedToBottom){for(var t=[],e=[],i=0;i<cases.length;i++){var n=cases[i];2===statuses[n.id]?t.push(n):e.push(n)}cases=e.concat(t)}if(settings.activeToTop){for(var s=[],o=[],l=0;l<cases.length;l++){var c=cases[l];1===statuses[c.id]?s.push(c):o.push(c)}cases=s.concat(o)}}function convertHeading(t){switch(t){case"name":return"Name";case"img":return"Case";case"alg":return"Algorithm";case"group":return"Group";case"status":return"";default:return t}}function convertContent(t,e,r){if("img"===e){if("solved"===r)return"<img class='case' src=\"https://cubing.net/api/visualcube/?fmt=png&bg=t&view=plan&pzl=3&stage="+algset+"&size="+settings.imgSize+'" />';var a="",i=chosenAlgs[t];return"y2"===i.substring(0,2)?a="transform: rotate(180deg)":"y'"===i.substring(0,2)?a="transform: rotate(270deg)":"y"===i.substring(0,1)&&(a="transform: rotate(90deg)"),"<img class='case' src=\"https://cubing.net/api/visualcube/?fmt=png&bg=t&view=plan&pzl=3&stage="+algset+"&size="+settings.imgSize+"&case="+getCaseById(t).alg[0]+"\" style='"+a+"' />"}switch(e){case"alg":return formatAlgNoRotation(chosenAlgs[t]);default:return r}}function addElement(t,e){var r=document.createElement(e);return t.appendChild(r),r}function toggleTriggers(){storeSetting("showTriggers",!settings.showTriggers),createTable()}function toggleStatus(t){t=Number(t);var e=document.getElementsByClassName(t)[0];if(2===statuses[t]){for(storeStatus(t,0);trainingCases.includes(t);)trainingCases.splice(trainingCases.indexOf(t),1);e.style.backgroundColor="white"}else 1===statuses[t]?(storeStatus(t,2),trainingCases.includes(t)||trainingCases.push(t),e.style.backgroundColor="rgb(0, 255, 0)"):(storeStatus(t,1),trainingCases.includes(t)||trainingCases.push(t),e.style.backgroundColor="rgb(255, 255, 0)")}function countMoves(t){var e=["r","u","f","l","d","b","m","s","e"],r=["x","y","z"],a="",i=!0,n=!1,s=void 0;try{for(var o,l=t[Symbol.iterator]();!(i=(o=l.next()).done);i=!0){var c=o.value;e.concat(r).includes(c.toLowerCase())&&a.substring(a.length-1)!=c&&(a+=c)}}catch(t){n=!0,s=t}finally{try{!i&&l.return&&l.return()}finally{if(n)throw s}}var g=0,u=!0,m=!1,h=void 0;try{for(var d,f=a[Symbol.iterator]();!(u=(d=f.next()).done);u=!0){var v=d.value;r.includes(v.toLowerCase())||g++}}catch(t){m=!0,h=t}finally{try{!u&&f.return&&f.return()}finally{if(m)throw h}}return g}function formatAlgNoRotation(t){if((t=t.trim()).startsWith("y"))for(var e=0;e<t.length;e++){var r=t.charAt(e);if("y"!==r&&"2"!==r&&"'"!==r&&" "!==r){t=t.substring(e,t.length);break}}for(var a=["y","y2","y'","x","x2","x'","z","z2","z'"],i=!0;i;){var n=!(i=!1),s=!1,o=void 0;try{for(var l,c=a[Symbol.iterator]();!(n=(l=c.next()).done);n=!0)for(var g=l.value;t.endsWith(g);)t=t.substring(0,t.length-g.length).trim(),i=!0}catch(t){s=!0,o=t}finally{try{!n&&c.return&&c.return()}finally{if(s)throw o}}}return formatAlg(t)}function formatAlg(t){return settings.showTriggers?formatAlgShowTriggers(t):formatAlgHideTriggers(t)}function formatAlgHideTriggers(t){t+=" ";var e=[],r=!0,a=!1,i=void 0;try{for(var n,s=["r","u","f","l","d","b","m","s","e"][Symbol.iterator]();!(r=(n=s.next()).done);r=!0){var o=n.value;e.push(o+" "+o+" "),e.push(o+"' "+o+"' ")}}catch(t){a=!0,i=t}finally{try{!r&&s.return&&s.return()}finally{if(a)throw i}}t=t.replace(/\(/g,"").replace(/\)/g,"");var l=!0,c=!1,g=void 0;try{for(var u,m=e[Symbol.iterator]();!(l=(u=m.next()).done);l=!0)for(var h=u.value;t.toLowerCase().includes(h);){var d=h.length,f=t.toLowerCase().indexOf(h);t=t.substring(0,f)+t.charAt(f)+"2"+t.substring(f+d,t.length)}}catch(t){c=!0,g=t}finally{try{!l&&m.return&&m.return()}finally{if(c)throw g}}return formatAlgPretty(t.trim())}function formatAlgShowTriggers(t){var e=["r","u","l"],r=[];r.push("r' f r f'","f r' f' r","l f' l' f","f' l f l'");var a=[["l","l'"],["l'","l"],["r","r'"],["r'","r"]],i=["u'","u"],n=!0,s=!1,o=void 0;try{for(var l,c=a[Symbol.iterator]();!(n=(l=c.next()).done);n=!0){var g=l.value,u=!0,m=!1,h=void 0;try{for(var d,f=i[Symbol.iterator]();!(u=(d=f.next()).done);u=!0){var v=d.value,y=!0,b=!1,p=void 0;try{for(var S,$=i[Symbol.iterator]();!(y=(S=$.next()).done);y=!0){var w=S.value;r.push(g[0]+" "+v+" "+g[1]+" "+w),r.push(v+" "+g[0]+" "+w+" "+g[1])}}catch(t){b=!0,p=t}finally{try{!y&&$.return&&$.return()}finally{if(b)throw p}}}}catch(t){m=!0,h=t}finally{try{!u&&f.return&&f.return()}finally{if(m)throw h}}}}catch(t){s=!0,o=t}finally{try{!n&&c.return&&c.return()}finally{if(s)throw o}}i.push("u2");var T=!0,C=!1,A=void 0;try{for(var k,I=a[Symbol.iterator]();!(T=(k=I.next()).done);T=!0){var x=k.value,B=!0,N=!1,E=void 0;try{for(var O,M=i[Symbol.iterator]();!(B=(O=M.next()).done);B=!0){var z=O.value;r.push(x[0]+" "+z+" "+x[1])}}catch(t){N=!0,E=t}finally{try{!B&&M.return&&M.return()}finally{if(N)throw E}}}}catch(t){C=!0,A=t}finally{try{!T&&I.return&&I.return()}finally{if(C)throw A}}for(var L=0;L<t.length;L++)if(e.includes(t.charAt(L).toLowerCase())){var D=t.substring(L,t.length).toLowerCase()+" ",H=!0,R=!1,F=void 0;try{for(var J,U=r[Symbol.iterator]();!(H=(J=U.next()).done);H=!0){var P=J.value;if(D.startsWith(P+" ")){t=t.substring(0,L)+"("+t.substring(L,L+P.length)+")"+t.substring(L+P.length),L+=P.length+1;break}}}catch(t){R=!0,F=t}finally{try{!H&&U.return&&U.return()}finally{if(R)throw F}}}return formatAlgPretty(t)}function formatAlgPretty(t){return t.replace(/ *([a-zA-Z]w?[2']?)/g," $1").replace(/2'/g,"2").replace(/\( /g,"(").trim()}function defaultChosenAlgs(){var t=Array.from({length:cases.length}).fill(null),e=!0,r=!1,a=void 0;try{for(var i,n=cases[Symbol.iterator]();!(e=(i=n.next()).done);e=!0){var s=i.value;t[s.id]=s.alg[0]}}catch(t){r=!0,a=t}finally{try{!e&&n.return&&n.return()}finally{if(r)throw a}}return t}function defaultStatuses(t){return Array.from({length:cases.length}).fill(0)}function defaultSettings(){return{sort:{attribute:"name",order:"1"},showTriggers:!1,finishedToBottom:!1,activeToTop:!1,trainOnInactive:!0,trainOnActive:!0,trainOnFinished:!0,imgSize:150}}function defaultTimes(){return[]}function getTrainingCases(){var t=[];settings.trainOnInactive&&t.push(0),settings.trainOnActive&&t.push(1),settings.trainOnFinished&&t.push(2);for(var e=[],r=0;r<chosenAlgs.length;r++)t.includes(statuses[r])&&e.push(r);return e}createTable(),$(".inactive").css("background-color",getColorByStatus(0)),$(".active").css("background-color",getColorByStatus(1)),$(".finished").css("background-color",getColorByStatus(2)),$("#resetButtonOrganizer").click(function(){confirm("Reset to defaults?")&&resetOrganizer()}),$("#trainerButtonOrganizer").click(function(){0<(trainingCases=getTrainingCases()).length?($("#organizer").hide(),$("#trainer").show(),timer.getNewScramble(),timer.displayTimes(),timer.hint=0):alert("No cases selected!")}),$("#organizerButtonTrainer").click(function(){$("#trainer").hide(),$("#organizer").show()}),$("#prevScrambleButton").click(function(){$("#scramble").html(timer.lastScramble)}),$("#currentScrambleButton").click(function(){$("#scramble").html(timer.thisScramble)}),$("#resetButtonTrainer").click(function(){deleteAllTimes(),timer.displayTimes()}),$(document).keydown(function(t){if(27===(t.keyCode||t.which)){var e=$("#gray");"none"!==$(e).css("display")?$(e).click():"none"!==$("#options").css("display")&&$("#optionsButtonOrganizer").click()}}),$(document).keyup(function(t){if(13===(t.keyCode||t.which)&&"none"!==$("#gray").css("display"))try{$("#editbox-submit button:first").click()}catch(t){}}),$("#gray").click(function(){$(".overlay").hide()}),allowOptions(),$("#resetAlgs").click(resetAlgs),$("#resetSettings").click(function(){resetSettings(),$("#options li").find("input").each(function(){this.checked=settings[this.name]})}),$("#optionsButtonOrganizer").click(function(){var t=$("#options");$(t).toggle()});var ver=1;function localStorageSupported(){try{return"localStorage"in window&&null!==window.localStorage}catch(t){return!1}}function storeChosenAlg(t,e){chosenAlgs[t]=e,localStorageSupported()&&localStorage.setItem("chosenAlgs"+algset,JSON.stringify(chosenAlgs))}function storeStatus(t,e){statuses[t]=e,localStorageSupported()&&localStorage.setItem("statuses"+algset,JSON.stringify(statuses))}function storeSetting(t,e){settings[t]=e,localStorageSupported()&&localStorage.setItem("settings"+algset,JSON.stringify(settings))}function storeTime(t,e,r){times.push({timeId:t,time:e,caseId:r}),localStorageSupported()&&localStorage.setItem("times"+algset,JSON.stringify(times))}function deleteTime(t){if(confirm("Delete the time "+getTimeById(t).time.toFixed(timer.numDecimals)+"?")){for(var e=0;e<times.length;e++)times[e].timeId==t&&times.splice(e,1);localStorageSupported()&&localStorage.setItem("times"+algset,JSON.stringify(times))}}function deleteAllTimes(){confirm("Reset all times?")&&(timer.timeId=0,times=defaultTimes(),localStorageSupported()&&localStorage.setItem("times"+algset,JSON.stringify(times)))}